<!DOCTYPE html>
<html>
<head>
	<!-- enable responsiveness -->
	<meta name="viewport" content="width=device-width, initial-scale=no">
	
	<title>Pal-Sac</title>

	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" type="text/javascript"></script>
	<link href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
	<script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"></script>

	<!-- Custom scripts and stylesheets -->
	<link rel="stylesheet" type="text/css" href="css/styles.css" media="all" />
	<!--<script type="text/javascript" src="/js/app.js"></script>-->

	<script type="text/javascript" 
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDY0kkJiTPVd2U7aTOAwhc9ySH6oHxOIYM&sensor=false&libraries=places,geometry">
	</script>

	<script type="text/javascript">
		$(function() {
			var autocomplete,
				locations,
				map; 

			// data
			locations = [
				{
					title: 'Our Town Cafe',
					address: '245 Broadway E, Vancouver, BC V5T 1W4',
					latLng: new google.maps.LatLng(49.263151, -123.100135)
				},
				{
					title: 'Toronto\'s First Post Office',
					address: '260 Adelaide St E, Toronto, ON M5A 1N1',
					latLng: new google.maps.LatLng(43.652002, -79.370439)
				}
			];

			function initialize() {
				var styles = [{
					stylers: [{
						saturation: -50 
					}]
				}];

				var mapOptions = {
					center: new google.maps.LatLng(56.697775, -105.429688), // centre at North America
					zoom: 3,
					styles: styles
				};
	      	
	      		map = new google.maps.Map($('#map-canvas').get(0), mapOptions);

	      		// mark each location on the map
	      		_.each(locations, function(location) {
		      		var marker = new google.maps.Marker({
		      			position: location.latLng,
		      			title: location.title,
		      			// icon: 'img/envolope.png' // use a custom marker icon
		      		});
		      		marker.setMap(map);

		      		// zoom in location on click event
		      		google.maps.event.addListener(marker, 'click', function() {
		      			map.setZoom(15);
		      			map.setCenter(marker.getPosition());

		      			var infoWindow = new google.maps.InfoWindow({
							content: '<b>' + marker.getTitle() + '</b><br>' + location.address
						});
						infoWindow.open(map,marker);
		      		});
	      		});

	      		// handle location search
		      	autocomplete = new google.maps.places.Autocomplete($('#search-box').get(0));
		      	google.maps.event.addListener(autocomplete, 'place_changed', onSearch);
	      	}

	      	google.maps.event.addDomListener(window, 'load', initialize);
	      	
	      	function onSearch() {
	      		var place = autocomplete.getPlace();
	      		if (place.geometry) {
	      			var from = place.geometry.location,
	      				minDist = Number.MAX_VALUE,
	      				minIndex;

	      			for (var i = 0, location; i < locations.length, location = locations[i]; i++) {
						var dist = google.maps.geometry.spherical.computeDistanceBetween(from, location.latLng);	      				
	      				if (dist < minDist) {
	      					minIndex = i;
	      					minDist = dist;
	      				}  
	      			}

	      			map.panTo(locations[minIndex].latLng);
	      			map.setZoom(10);
	      		} 
			}

	    });
    </script>
 </head>

 <body>
 	<div class="container form-group">
 		<h3><span class="glyphicon glyphicon-envelope"></span> Find Your Pal-Sac</h3>
 		<div class="form-group">
 			<input type="text" class="form-control input-lg" id="search-box" placeholder="Enter a city name, or a postal code">
 			<!--<div class="input-group-btn">
 				<button class="btn btn-info btn-lg input-lg" id="search-btn">
 					<span class="glyphicon glyphicon-search"></span>
 				</button>
 			</div>-->
 		</div>
 	</div>
 	<div id="map-canvas"></div>
 	<!--<div class="container well" id="locationList">
 		<ul></ul>
 	</div>-->

 </body>

</html>
